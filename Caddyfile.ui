(cors) {
	header {

		Access-Control-Allow-Methods "GET,OPTIONS,PUT,POST,DELETE,HEAD,PATCH"
		Access-Control-Allow-Headers content-type
		Access-Control-Max-Age 100
		Access-Control-Allow-Origin *
		defer
	}
}

(handle_path_route_without_auth) {
	# handle_path automatically strips the prefix from the request path
	handle_path {args.0}* {
		reverse_proxy {args.1}

		import cors

	}
}

{
	order versions after metrics

	debug
}

:8080 {
    # Proxy to the host machine's ledger
	import handle_path_route_without_auth "/api/ledger" "host.docker.internal:3068"

	handle /api/versions {
		header Content-Type application/json
		import cors
		respond `{"region":"default","env":"default","versions":[{"name":"ledger","version":"develop","health":true}]}` 200
	}

	handle /versions {
		header Content-Type application/json
		import cors
		respond `{"region":"default","env":"default","versions":[{"name":"ledger","version":"develop","health":true}]}` 200
	}

	# handle all other requests
	handle {
		respond "Bad Gateway" 502
	}

}
